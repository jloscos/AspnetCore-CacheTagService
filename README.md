# AspnetCore-CacheTagService

This service for ASP.NET Core lets you invalidate cache generated by the cache tag

## Warning

This uses reflection to access private members of the IMemoryCache service. It only works if it's the default MemoryCache service that is used in the application.


## Exemple


in Startup.cs 
```csharp
using CacheTagService;

public class Startup
{
  public void ConfigureServices(IServiceCollection services)
  {
    services.AddCacheTagService();
  }
}
```

In a view :
```
    <cache vary-by-query="_sw-precache" vary-by-route="clientRoute" >
        ...
    </cache>
```

in a Controller :

```csharp
public class MyController : Controller
{
    private ICacheTagService _cacheTagService;
    public MyController(ICacheTagService cacheTagService)
    {
        _cacheTagService = cacheTagService;
    }


    [HttpPost]
    public ActionResult UpdateData(Model newData)
    {
        UpdateData(newData);
        //Invalidate cache
        _cacheTagService.RemoveWhere(k => k.RouteValues["clientRoute"] == "path/to/my/view");
        return Ok("ok");
    }
}
```

## Methods 

#### GetKeys 
Gets all the keys in the memory cache of the cache tag. 
Returns a list of ReadableCacheTagKey

```csharp
ICacheTagService _cacheTagService;

IList<ReadableCacheTagKey> keys = _cacheTagService.GetKeys();
```

#### Remove
Remove the cache associated with the given key.
Takes in parameter a ReadableCacheTagKey.

```csharp
ICacheTagService _cacheTagService;

ReadableCacheTagKey key;
_cacheTagService.Remove(key);
```

#### RemoveWhere
Remove all the values associated to the keys that match the given predicate
```csharp
ICacheTagService _cacheTagService;

_cacheTagService.RemoveWhere(k => k.Queries["Name"] == "John");
```
